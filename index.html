
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chemin de Fer Interactif - Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f4f5f7;
    }
    .editable, .editable-title {
        padding: 6px 8px;
        border-radius: 4px;
        transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .editable {
        min-height: 40px;
    }
    .editable:focus, .editable-title:focus {
        background-color: #ffffff;
        outline: none;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }
    .header-grid {
        display: grid;
        grid-template-columns: 50px 1fr 80px 1.5fr 1.5fr 1.5fr 1.5fr 50px;
        gap: 0.75rem;
        align-items: center;
    }
    .sequence-grid {
        display: grid;
        grid-template-columns: 50px 1fr 80px 1.5fr 1.5fr 1.5fr 1.5fr 50px;
        gap: 0.75rem;
        align-items: start;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #e5e7eb;
    }
  </style>
</head>
<body class="text-gray-800">

  <div class="container mx-auto p-4 md:p-8">
    <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Chemin de Fer Interactif</h1>
      <p class="text-gray-600 mt-2">Film : Réunion Annuelle La Réunion
</p>
      <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
                <p><span class="font-bold">Instructions :</span> Tous les champs sont modifiables. Cliquez sur un texte pour le changer. Les modifications sont sauvegardées lorsque vous cliquez sur "Sauvegarder".</p>
            </div>
      <div class="mt-6 flex flex-wrap gap-4">
        <button id="save-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none">
          Sauvegarder
        </button>
      </div>
    </div>
    <div id="sequences-container" class="space-y-6"></div>
    <div class="text-center mt-6">
      <button id="add-section-btn" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">
        + Ajouter une section
      </button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD9ywufiVmGP7WEjUSqljvgBkO8UI770bc",
      authDomain: "chemin-de-fer.firebaseapp.com",
      projectId: "chemin-de-fer",
      storageBucket: "chemin-de-fer.firebasestorage.app",
      messagingSenderId: "587300714420",
      appId: "1:587300714420:web:f425c64e8ce0a283a024e1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const docRef = db.collection("cheminDeFer").doc("data");

    let sequencesData = [];
    const container = document.getElementById('sequences-container');

    const render = () => {
      container.innerHTML = '';
      sequencesData.forEach((sectionData, sectionIndex) => {
        const sectionElement = document.createElement('div');
        sectionElement.className = 'bg-white rounded-2xl shadow-lg';
        sectionElement.innerHTML = `
          <details ${sectionData.open ? 'open' : ''}>
            <summary class="p-4 md:p-6 cursor-pointer flex justify-between items-center">
              <h2 class="editable-title text-xl md:text-2xl font-bold text-gray-800" contenteditable="true" data-section-index="${sectionIndex}">${sectionData.section}</h2>
            </summary>
            <div class="px-4 md:px-6 pb-4">
              <div class="header-grid font-semibold text-gray-500 text-sm uppercase tracking-wider p-4 hidden md:grid">
                <div>SEQ</div><div>Thème</div><div>Durée</div><div>Visuel</div><div>Audio</div><div>Message</div><div>Timecodes</div><div></div>
              </div>
              <div id="section-content-${sectionIndex}"></div>
              <div class="mt-4">
                <button data-section-index="${sectionIndex}" class="add-sequence-btn px-4 py-2 bg-green-100 text-green-800 font-semibold rounded-lg hover:bg-green-200 text-sm">
                  + Ajouter une séquence
                </button>
              </div>
            </div>
          </details>`;
        container.appendChild(sectionElement);
        const sectionContent = document.getElementById(`section-content-${sectionIndex}`);
        if (sectionData.sequences) {
          sectionData.sequences.forEach((seq, seqIndex) => {
            const seqElement = document.createElement('div');
            seqElement.className = 'sequence-grid';
            seqElement.innerHTML = `
              <div class="text-center font-bold">${sectionIndex + 1}.${seqIndex + 1}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="theme">${seq.theme}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="duration">${seq.duration}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="visual">${seq.visual}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="audio">${seq.audio}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="message">${seq.message}</div>
              <div class="editable bg-gray-50" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="timecodes">${seq.timecodes}</div>
              <div></div>`;
            sectionContent.appendChild(seqElement);
          });
        }
      });
      attachEventListeners();
    };

    const attachEventListeners = () => {
      document.querySelectorAll('.editable').forEach(el => {
        el.addEventListener('blur', (e) => {
          const { section, seq, field } = e.target.dataset;
          sequencesData[section].sequences[seq][field] = e.target.innerText;
        });
      });
      document.querySelectorAll('.editable-title').forEach(el => {
        el.addEventListener('blur', (e) => {
          const { sectionIndex } = e.target.dataset;
          sequencesData[sectionIndex].section = e.target.innerText;
        });
      });
      document.querySelectorAll('.add-sequence-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const { sectionIndex } = e.target.dataset;
          sequencesData[sectionIndex].sequences.push({
            theme: "Nouveau Thème",
            duration: "0'00",
            visual: "Description visuelle",
            audio: "Description sonore",
            message: "Message clé",
            timecodes: "Source (ID): 00:00-00:00"
          });
          render();
        });
      });
    };

    
  document.getElementById('add-section-btn').addEventListener('click', () => {
      const newSection = {
        section: "Nouvelle section de démonstration",
        open: true,
        sequences: [
          {
            theme: "Thème de démonstration",
            duration: "0'45",
            visual: "Exemple d'image ou plan visuel",
            audio: "Texte audio exemple",
            message: "Message clé de démonstration",
            timecodes: "00:00-00:45"
          }
        ]
      };
      sequencesData.push(newSection);
      render();
    });

    document.getElementById('save-btn').addEventListener('click', () => {
      docRef.set({ sections: sequencesData });
    });

    
docRef.onSnapshot(async doc => {
      if (!doc.exists || !doc.data().sections || doc.data().sections.length === 0) {
        // Initialisation des données par défaut
        const defaultData = [
          {
            section: "Exemple de Section",
            open: true,
            sequences: [
              {
                theme: "Thème Exemple",
                duration: "1'00",
                visual: "Description visuelle",
                audio: "Description sonore",
                message: "Message clé",
                timecodes: "00:00-01:00"
              }
            ]
          }
        ];
        await docRef.set({ sections: defaultData });
        sequencesData = defaultData;
        render();
        return;
      }

      sequencesData = doc.exists ? doc.data().sections || [] : [];
      render();
    });
  </script>
</body>
</html>
