<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chemin de Fer Interactif - Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    .editable, .editable-title {
      padding: 6px 8px;
      border-radius: 4px;
      transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .editable:focus, .editable-title:focus {
      background-color: #fff;
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <div class="container mx-auto p-4 md:p-8">
    <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg mb-8">
      <h1 class="text-xl md:text-3xl font-bold text-gray-900">Chemin de Fer Interactif</h1>
      <p class="text-gray-600 mt-2 text-sm md:text-base">Film : Réunion Annuelle La Réunion</p>
      <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
        <p><strong>Instructions :</strong> Tous les champs sont modifiables. Cliquez sur un texte pour le changer. Les modifications sont sauvegardées lorsque vous cliquez sur "Sauvegarder".</p>
      </div>
      <div class="mt-6 flex flex-col md:flex-row gap-4">
        <button id="save-btn" class="w-full md:w-auto px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700">
          Sauvegarder
        </button>
      </div>
    </div>

    <div id="sequences-container" class="space-y-6"></div>

    <div class="text-center mt-6">
      <button id="add-section-btn" class="w-full md:w-auto px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">
        + Ajouter une section
      </button>
    </div>
  </div>

   <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD9ywufiVmGP7WEjUSqljvgBkO8UI770bc",
      authDomain: "chemin-de-fer.firebaseapp.com",
      projectId: "chemin-de-fer",
      storageBucket: "chemin-de-fer.firebasestorage.app",
      messagingSenderId: "587300714420",
      appId: "1:587300714420:web:f425c64e8ce0a283a024e1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const docRef = db.collection("cheminDeFer").doc("data");

    let sequencesData = [];
    const container = document.getElementById('sequences-container');

const render = () => {
  container.innerHTML = '';
  sequencesData.forEach((sectionData, sectionIndex) => {
    const sectionElement = document.createElement('div');
    sectionElement.className = 'bg-white rounded-2xl shadow-lg';
    sectionElement.innerHTML = `
      <details ${sectionData.open ? 'open' : ''}>
        <summary class="p-4 md:p-6 cursor-pointer flex justify-between items-center">
          <h2 class="editable-title text-xl md:text-2xl font-bold text-gray-800" contenteditable="true" data-section-index="${sectionIndex}">${sectionData.section}</h2>
        </summary>
        <div class="px-4 md:px-6 pb-4">
          <div class="hidden md:grid grid-cols-[50px_1fr_80px_1.5fr_1.5fr_1.5fr_1.5fr_50px] gap-3 font-semibold text-gray-500 text-sm uppercase tracking-wider p-4">
            <div>SEQ</div><div>Thème</div><div>Durée</div><div>Visuel</div><div>Audio</div><div>Message</div><div>Timecodes</div><div></div>
          </div>
          <div id="section-content-${sectionIndex}" class="space-y-4"></div>
          <div class="mt-4">
            <button data-section-index="${sectionIndex}" class="add-sequence-btn px-4 py-2 bg-green-100 text-green-800 font-semibold rounded-lg hover:bg-green-200 text-sm">
              + Ajouter une séquence
            </button>
          </div>
        </div>
      </details>`;
    container.appendChild(sectionElement);

    const sectionContent = document.getElementById(`section-content-${sectionIndex}`);
    if (sectionData.sequences) {
      sectionData.sequences.forEach((seq, seqIndex) => {
        const seqElement = document.createElement('div');
        seqElement.className = 'grid grid-cols-1 md:grid-cols-[50px_1fr_80px_1.5fr_1.5fr_1.5fr_1.5fr_50px] gap-2 md:gap-3 items-start bg-white border rounded-lg p-4';

        seqElement.innerHTML = `
          <div class="font-bold text-sm text-center md:text-left">${sectionIndex + 1}.${seqIndex + 1}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="theme">${seq.theme}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="duration">${seq.duration}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="visual">${seq.visual}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="audio">${seq.audio}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="message">${seq.message}</div>
          <div class="editable bg-gray-50 p-2 rounded" contenteditable="true" data-section="${sectionIndex}" data-seq="${seqIndex}" data-field="timecodes">${seq.timecodes}</div>
          <div class="text-center">
            <button data-section="${sectionIndex}" data-seq="${seqIndex}" class="delete-sequence-btn p-2 text-gray-400 hover:text-red-600 rounded-full">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
        `;
        sectionContent.appendChild(seqElement);
      });
    }
  });
  attachEventListeners();
};

    const attachEventListeners = () => {
      document.querySelectorAll('.editable').forEach(el => {
        el.addEventListener('blur', (e) => {
          const { section, seq, field } = e.target.dataset;
          sequencesData[section].sequences[seq][field] = e.target.innerText;
        });
      });
      document.querySelectorAll('.editable-title').forEach(el => {
        el.addEventListener('blur', (e) => {
          const { sectionIndex } = e.target.dataset;
          sequencesData[sectionIndex].section = e.target.innerText;
        });
      });
document.querySelectorAll('.delete-sequence-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const { section, seq } = e.currentTarget.dataset;
    sequencesData[section].sequences.splice(seq, 1);
    render();
  });
});

    document.querySelectorAll('.add-sequence-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const { sectionIndex } = e.target.dataset;
          sequencesData[sectionIndex].sequences.push({
            theme: "Nouveau Thème",
            duration: "0'00",
            visual: "Description visuelle",
            audio: "Description sonore",
            message: "Message clé",
            timecodes: "Source (ID): 00:00-00:00"
          });
          render();
        });
      });
    };

    
    document.getElementById('add-section-btn').addEventListener('click', () => {
      const newSection = {
        section: "Nouvelle section de démonstration",
        open: true,
        sequences: [
          {
            theme: "Thème de démonstration",
            duration: "0'45",
            visual: "Exemple d'image ou plan visuel",
            audio: "Texte audio exemple",
            message: "Message clé de démonstration",
            timecodes: "00:00-00:45"
          }
        ]
      };
      sequencesData.push(newSection);
      render();
    });    
docRef.get().then(async doc => {
  if (!doc.exists || !doc.data().sections || doc.data().sections.length === 0) {
    // Initialisation des données par défaut
    const defaultData = [
      {
        section: "Entreprendre pour la solidarité",
        open: true,
        sequences: [
          {
            theme: "Réponse à la Crise & Soutien Logistique",
            duration: "1'00\"",
            visual: "Images de la crise Covid (stylisées). Plans des entrepôts de la Banque Alimentaire, bénévoles en action. Focus sur les conteneurs de denrées.",
            audio: "VO (Montage de discours): \"Au mois de mars 2020, la crise du qu'Ovide se déclenche... L'attitude de nos collaborateurs est exemplaire.\" + \"Nous réussissons à importer... 1 350 000 masques.\"",
            message: "En temps de crise, le groupe est un pilier de la société, capable de mobiliser sa puissance logistique pour le bien commun.",
            timecodes: "Soirée des collaborateurs (longue): 01:08-01:14 (crise du qu'Ovide...) | Soirée des collaborateurs (longue): 01:57-02:13 (1 350 000 masques)"
          },
          {
            theme: "Le Partenariat avec la Banque Alimentaire",
            duration: "1'15\"",
            visual: "Extraits de la vidéo sur la Banque Alimentaire. Plans du camion-cuisine en action, ateliers culinaires, distribution. Témoignage d'un responsable de la BA.",
            audio: "Témoignage (Banque Alimentaire): \"C'est pas seulement un partenaire sur le transport maritime mais c'est également un partenaire dans le mécénat financier... et sur la ramasse à travers la filiale Carrefour.\" + Focus sur le camion-cuisine et son rôle nutritionnel.",
            message: "La solidarité de GBH est un engagement profond, multiforme (logistique, financier, dons) et innovant, qui s'attaque aux causes profondes des problèmes sociaux.",
            timecodes: "Vidéo Banque Alimentaire (01hK7efHWio): 00:50-01:05 (soutien multiforme) | Vidéo Banque Alimentaire (01hK7efHWio): 01:23-01:37 (camion-cuisine)"
          }
        ]
      },
      {
        section: "Entreprendre pour l'emploi",
        open: false,
        sequences: [
          {
            theme: "Tremplin pour l'Emploi : Donner une Chance",
            duration: "1'00\"",
            visual: "Images des programmes TPE avec le RSMA et l'E2C. Jeunes en formation (militaire, mécanique, vente). Témoignages d'Anaïs Regnault ou Cécile Cavalie.",
            audio: "Témoignage (RRH ou M. Lapeyre): \"Tremplin pour l'emploi... s'adresse à des jeunes éloignés de l'emploi... l'ambition de recruter 15 jeunes en vue de préparer un titre professionnel...\" + Focus sur le \"savoir-être\".",
            message: "GBH investit dans la jeunesse en difficulté, en lui offrant non seulement des compétences techniques mais aussi les codes du monde professionnel.",
            timecodes: "Vidéo TPE RSMA (Oi-JXBtkNp4): 00:05-00:25 (présentation) | Vidéo TPE Département (oN_rl4x6WDw): 00:06-00:16 (partenariat)"
          },
          {
            theme: "Construire les Carrières : DistriSup & EGC",
            duration: "0'45\"",
            visual: "Extraits des vidéos sur DistriSup et l'EGC. Étudiants en alternance, en stage. Témoignage d'Amaury de Lavigne.",
            audio: "Témoignage (A. de Lavigne): \"Nous avons 30% de nos cadres qui sont issus de ce cursus de formation.\" + \"100% des jeunes qui ont suivi ce parcours... sont aujourd'hui des jeunes à responsabilité dans l'entreprise.\"",
            message: "GBH forme ses propres managers de demain en partenariat avec les meilleures écoles locales, garantissant un pipeline de talents.",
            timecodes: "Vidéo DistriSup (Y-pek71Eh3c): 00:37-00:42 (30% cadres) | Vidéo EGC (kBI5in_XnqI): 00:57-01:01 (103 stagiaires)"
          },
          {
            theme: "Le Témoignage Collaborateur : L'Évolution Interne",
            duration: "0'45\"",
            visual: "Portrait de Sullivan Bousleiman dans son magasin Carrefour. Interaction avec ses équipes.",
            audio: "Témoignage (S. Bousleiman): \"Mon parcours a débuté en tant que directeur adjoint, puis j'ai été promu directeur...\" + \"J'ai trouvé dans GBH une autonomie et une liberté d'entreprendre qui sont mes maîtres mots au quotidien.\"",
            message: "Le groupe offre de réelles perspectives d'évolution et une culture d'entreprise qui valorise l'autonomie et l'initiative.",
            timecodes: "Vidéo Sullivan (AlHd-BrAGPQ): 00:22-00:33 (parcours) | Vidéo Sullivan (AlHd-BrAGPQ): 00:44-00:51 (autonomie)"
          }
        ]
      }
    ];

    await docRef.set({ sections: defaultData });
    sequencesData = defaultData;
    render();
  }

  sequencesData = doc.data().sections || [];
  render();
});

// Sauvegarde des données dans Firestore
document.getElementById('save-btn').addEventListener('click', () => {
  docRef.set({ sections: sequencesData })
    .then(() => {
      alert("✅ Données sauvegardées avec succès !");
    })
    .catch(error => {
      console.error("❌ Erreur lors de la sauvegarde :", error);
      alert("Erreur lors de la sauvegarde. Voir la console.");
    });
});


  </script>
</body>
</html>
